{"version":3,"sources":["../../src/middleware/auth.middleware.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\r\nimport passport from \"passport\";\r\n\r\nexport const auth: RequestHandler = (req, res, next) => {\r\n  passport.authenticate(\r\n    \"jwt\",\r\n    { session: false },\r\n    (err: any, user: Express.User | undefined, info: { message: string }) => {\r\n      const { refreshToken } = req.cookies;\r\n\r\n      if (err) {\r\n        return res.status(500).json({ message: \"Authentication error\" });\r\n      }\r\n\r\n      if (!user || !refreshToken) {\r\n        if (info && info.message) {\r\n          return res.status(401).json({ message: info.message });\r\n        }\r\n        return res.status(401).json({ message: \"Unauthorized\" });\r\n      }\r\n\r\n      req.user = user;\r\n      next();\r\n    }\r\n  )(req, res, next);\r\n};\r\n\r\nexport const optionalAuth: RequestHandler = (req, res, next) => {\r\n  passport.authenticate(\r\n    \"jwt\",\r\n    { session: false },\r\n    (err: any, user: Express.User | undefined, info: { message: string }) => {\r\n      const { refreshToken } = req.cookies;\r\n\r\n      if (err) {\r\n        return res.status(500).json({ message: \"Authentication error\" });\r\n      }\r\n\r\n      if (user && refreshToken) {\r\n        req.user = user;\r\n      } else if (info && info.message) {\r\n        return res.status(401).json({ message: info.message });\r\n      }\r\n\r\n      next();\r\n    }\r\n  )(req, res, next);\r\n};\r\n"],"names":["auth","optionalAuth","req","res","next","passport","authenticate","session","err","user","info","refreshToken","cookies","status","json","message"],"mappings":"8LAGaA,IAAI,mBAAJA,MAwBAC,YAAY,mBAAZA,iEA1BQ,iGAEd,MAAMD,KAAuB,CAACE,IAAKC,IAAKC,QAC7CC,iBAAQ,CAACC,YAAY,CACnB,MACA,CAAEC,QAAS,KAAM,EACjB,CAACC,IAAUC,KAAgCC,QACzC,KAAM,CAAEC,YAAY,CAAE,CAAGT,IAAIU,OAAO,CAEpC,GAAIJ,IAAK,CACP,OAAOL,IAAIU,MAAM,CAAC,KAAKC,IAAI,CAAC,CAAEC,QAAS,sBAAuB,EAChE,CAEA,GAAI,CAACN,MAAQ,CAACE,aAAc,CAC1B,GAAID,MAAQA,KAAKK,OAAO,CAAE,CACxB,OAAOZ,IAAIU,MAAM,CAAC,KAAKC,IAAI,CAAC,CAAEC,QAASL,KAAKK,OAAO,AAAC,EACtD,CACA,OAAOZ,IAAIU,MAAM,CAAC,KAAKC,IAAI,CAAC,CAAEC,QAAS,cAAe,EACxD,CAEAb,IAAIO,IAAI,CAAGA,KACXL,MACF,GACAF,IAAKC,IAAKC,KACd,EAEO,MAAMH,aAA+B,CAACC,IAAKC,IAAKC,QACrDC,iBAAQ,CAACC,YAAY,CACnB,MACA,CAAEC,QAAS,KAAM,EACjB,CAACC,IAAUC,KAAgCC,QACzC,KAAM,CAAEC,YAAY,CAAE,CAAGT,IAAIU,OAAO,CAEpC,GAAIJ,IAAK,CACP,OAAOL,IAAIU,MAAM,CAAC,KAAKC,IAAI,CAAC,CAAEC,QAAS,sBAAuB,EAChE,CAEA,GAAIN,MAAQE,aAAc,CACxBT,IAAIO,IAAI,CAAGA,IACb,MAAO,GAAIC,MAAQA,KAAKK,OAAO,CAAE,CAC/B,OAAOZ,IAAIU,MAAM,CAAC,KAAKC,IAAI,CAAC,CAAEC,QAASL,KAAKK,OAAO,AAAC,EACtD,CAEAX,MACF,GACAF,IAAKC,IAAKC,KACd"}