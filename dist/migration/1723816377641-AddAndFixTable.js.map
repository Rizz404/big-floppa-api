{"version":3,"sources":["../../src/migration/1723816377641-AddAndFixTable.ts"],"sourcesContent":["import { MigrationInterface, QueryRunner } from \"typeorm\";\n\nexport class AddAndFixTable1723816377641 implements MigrationInterface {\n    name = 'AddAndFixTable1723816377641'\n\n    public async up(queryRunner: QueryRunner): Promise<void> {\n        await queryRunner.query(`ALTER TABLE \\`user\\` DROP FOREIGN KEY \\`FK_9466682df91534dd95e4dbaa616\\``);\n        await queryRunner.query(`DROP INDEX \\`REL_9466682df91534dd95e4dbaa61\\` ON \\`user\\``);\n        await queryRunner.query(`CREATE TABLE \\`user_payment_account\\` (\\`id\\` varchar(36) NOT NULL, \\`bankName\\` varchar(255) NOT NULL, \\`description\\` text NOT NULL, \\`accountNumber\\` varchar(255) NOT NULL, \\`accountHolderName\\` varchar(255) NOT NULL, \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`cart\\` (\\`id\\` varchar(36) NOT NULL, \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \\`userId\\` varchar(36) NULL, UNIQUE INDEX \\`REL_756f53ab9466eb52a52619ee01\\` (\\`userId\\`), PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`cart_item\\` (\\`id\\` varchar(36) NOT NULL, \\`quantity\\` int NOT NULL DEFAULT '1', \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \\`cartId\\` varchar(36) NULL, \\`catId\\` varchar(36) NULL, PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`shipping_service\\` (\\`id\\` varchar(36) NOT NULL, \\`name\\` varchar(255) NOT NULL, \\`description\\` text NOT NULL, \\`fee\\` decimal NOT NULL, \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`payment\\` (\\`id\\` varchar(36) NOT NULL, \\`paymentMethod\\` varchar(50) NOT NULL, \\`status\\` enum ('PENDING', 'COMPLETED', 'FAILED') NOT NULL DEFAULT 'PENDING', \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`transaction\\` (\\`id\\` varchar(36) NOT NULL, \\`fee\\` decimal NOT NULL, \\`subTotal\\` decimal NOT NULL, \\`total\\` decimal NOT NULL, \\`transactionDate\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \\`buyerId\\` varchar(36) NULL, \\`sellerId\\` varchar(36) NULL, \\`paymentId\\` varchar(36) NULL, PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`CREATE TABLE \\`order\\` (\\`id\\` varchar(36) NOT NULL, \\`status\\` enum ('PACKAGING', 'SHIPPED', 'DELIVERED', 'RECEIVED') NOT NULL DEFAULT 'PACKAGING', \\`amount\\` int NOT NULL DEFAULT '1', \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \\`userId\\` varchar(36) NULL, \\`catId\\` varchar(36) NULL, \\`shippingServiceId\\` varchar(36) NULL, \\`transactionId\\` varchar(36) NULL, PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n        await queryRunner.query(`ALTER TABLE \\`user\\` DROP COLUMN \\`profileId\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` ADD \\`userId\\` varchar(36) NULL`);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` ADD UNIQUE INDEX \\`IDX_a24972ebd73b106250713dcddd\\` (\\`userId\\`)`);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` ADD \\`price\\` decimal NOT NULL`);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` ADD \\`quantity\\` int NOT NULL DEFAULT '1'`);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` ADD \\`status\\` enum ('AVAILABLE', 'SOLD', 'ADOPTED') NOT NULL DEFAULT 'AVAILABLE'`);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` DROP COLUMN \\`phoneNumber\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` ADD \\`phoneNumber\\` varchar(30) NULL`);\n        await queryRunner.query(`CREATE UNIQUE INDEX \\`REL_a24972ebd73b106250713dcddd\\` ON \\`profile\\` (\\`userId\\`)`);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` ADD CONSTRAINT \\`FK_a24972ebd73b106250713dcddd9\\` FOREIGN KEY (\\`userId\\`) REFERENCES \\`user\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`cart\\` ADD CONSTRAINT \\`FK_756f53ab9466eb52a52619ee019\\` FOREIGN KEY (\\`userId\\`) REFERENCES \\`user\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`cart_item\\` ADD CONSTRAINT \\`FK_29e590514f9941296f3a2440d39\\` FOREIGN KEY (\\`cartId\\`) REFERENCES \\`cart\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`cart_item\\` ADD CONSTRAINT \\`FK_2e26b46addf458c6b771a9c4583\\` FOREIGN KEY (\\`catId\\`) REFERENCES \\`cat\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` ADD CONSTRAINT \\`FK_2ef5d5742e52e2bca6d8798dda5\\` FOREIGN KEY (\\`buyerId\\`) REFERENCES \\`user\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` ADD CONSTRAINT \\`FK_da429de57e23852dae37f1d182b\\` FOREIGN KEY (\\`sellerId\\`) REFERENCES \\`user\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` ADD CONSTRAINT \\`FK_26ba3b75368b99964d6dea5cc2c\\` FOREIGN KEY (\\`paymentId\\`) REFERENCES \\`payment\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`order\\` ADD CONSTRAINT \\`FK_caabe91507b3379c7ba73637b84\\` FOREIGN KEY (\\`userId\\`) REFERENCES \\`user\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`order\\` ADD CONSTRAINT \\`FK_6fb7cd7ffd261d468bdbd092e8f\\` FOREIGN KEY (\\`catId\\`) REFERENCES \\`cat\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`order\\` ADD CONSTRAINT \\`FK_6a0ffd40a9608605f96bb071d0f\\` FOREIGN KEY (\\`shippingServiceId\\`) REFERENCES \\`shipping_service\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n        await queryRunner.query(`ALTER TABLE \\`order\\` ADD CONSTRAINT \\`FK_8f2bb52a4384d2d5f1ff59fb9e6\\` FOREIGN KEY (\\`transactionId\\`) REFERENCES \\`transaction\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n    }\n\n    public async down(queryRunner: QueryRunner): Promise<void> {\n        await queryRunner.query(`ALTER TABLE \\`order\\` DROP FOREIGN KEY \\`FK_8f2bb52a4384d2d5f1ff59fb9e6\\``);\n        await queryRunner.query(`ALTER TABLE \\`order\\` DROP FOREIGN KEY \\`FK_6a0ffd40a9608605f96bb071d0f\\``);\n        await queryRunner.query(`ALTER TABLE \\`order\\` DROP FOREIGN KEY \\`FK_6fb7cd7ffd261d468bdbd092e8f\\``);\n        await queryRunner.query(`ALTER TABLE \\`order\\` DROP FOREIGN KEY \\`FK_caabe91507b3379c7ba73637b84\\``);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` DROP FOREIGN KEY \\`FK_26ba3b75368b99964d6dea5cc2c\\``);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` DROP FOREIGN KEY \\`FK_da429de57e23852dae37f1d182b\\``);\n        await queryRunner.query(`ALTER TABLE \\`transaction\\` DROP FOREIGN KEY \\`FK_2ef5d5742e52e2bca6d8798dda5\\``);\n        await queryRunner.query(`ALTER TABLE \\`cart_item\\` DROP FOREIGN KEY \\`FK_2e26b46addf458c6b771a9c4583\\``);\n        await queryRunner.query(`ALTER TABLE \\`cart_item\\` DROP FOREIGN KEY \\`FK_29e590514f9941296f3a2440d39\\``);\n        await queryRunner.query(`ALTER TABLE \\`cart\\` DROP FOREIGN KEY \\`FK_756f53ab9466eb52a52619ee019\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` DROP FOREIGN KEY \\`FK_a24972ebd73b106250713dcddd9\\``);\n        await queryRunner.query(`DROP INDEX \\`REL_a24972ebd73b106250713dcddd\\` ON \\`profile\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` DROP COLUMN \\`phoneNumber\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` ADD \\`phoneNumber\\` varchar(20) NULL`);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` DROP COLUMN \\`status\\``);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` DROP COLUMN \\`quantity\\``);\n        await queryRunner.query(`ALTER TABLE \\`cat\\` DROP COLUMN \\`price\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` DROP INDEX \\`IDX_a24972ebd73b106250713dcddd\\``);\n        await queryRunner.query(`ALTER TABLE \\`profile\\` DROP COLUMN \\`userId\\``);\n        await queryRunner.query(`ALTER TABLE \\`user\\` ADD \\`profileId\\` varchar(36) NULL`);\n        await queryRunner.query(`DROP TABLE \\`order\\``);\n        await queryRunner.query(`DROP TABLE \\`transaction\\``);\n        await queryRunner.query(`DROP TABLE \\`payment\\``);\n        await queryRunner.query(`DROP TABLE \\`shipping_service\\``);\n        await queryRunner.query(`DROP TABLE \\`cart_item\\``);\n        await queryRunner.query(`DROP INDEX \\`REL_756f53ab9466eb52a52619ee01\\` ON \\`cart\\``);\n        await queryRunner.query(`DROP TABLE \\`cart\\``);\n        await queryRunner.query(`DROP TABLE \\`user_payment_account\\``);\n        await queryRunner.query(`CREATE UNIQUE INDEX \\`REL_9466682df91534dd95e4dbaa61\\` ON \\`user\\` (\\`profileId\\`)`);\n        await queryRunner.query(`ALTER TABLE \\`user\\` ADD CONSTRAINT \\`FK_9466682df91534dd95e4dbaa616\\` FOREIGN KEY (\\`profileId\\`) REFERENCES \\`profile\\`(\\`id\\`) ON DELETE NO ACTION ON UPDATE NO ACTION`);\n    }\n\n}\n"],"names":["AddAndFixTable1723816377641","name","up","queryRunner","query","down"],"mappings":"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"}